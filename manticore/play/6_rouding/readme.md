# about

Initialization

    Create one account
    Create the contract account

Exploration

    Call is_valid_buy with two symbolic values for tokens_amount and wei_amount

Property

    An attack is found if on a state alive wei_amount == 0 and tokens_amount >= 1


## solution


### run

```
(manticore_native) (REDF)vlad@vladis:play/6_rouding ‹main*›$ python 6_run.py   

Bug found, results are in /data/redef/research/manticore/play/6_rouding/mcore_ky1o9u7h



Transactions No. 0
Type: CREATE (0)
From: normal0(0x4bd5dd46b6ac3bbccc902b6793522b2af3cd5b23) 
To: contract0(0x7804cf72feb0ef67342e2053422914f71f7930b2) 
Value: 0 
Gas used: 3000000 
Data: 0x60806040526001805568056bc75e2d6310000060025534801561002157600080fd5b50610237806100316000396000f3fe6080604052600436106100295760003560e01c8063d96a094a1461002e578063df3cfd771461005c575b600080fd5b61005a6004803603602081101561004457600080fd5b81019080803590602001909291905050506100b9565b005b34801561006857600080fd5b5061009f6004803603604081101561007f57600080fd5b8101908080359060200190929190803590602001909291905050506100d0565b604051808215151515815260200191505060405180910390f35b6100c381346100e6565b6100cd338261010b565b50565b60006100dc83836100e6565b6001905092915050565b6000600154600a84816100f557fe5b040290508082101561010657600080fd5b505050565b6101536000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054826101e7565b6000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff167f0f6798a560793a54c3bcfe86a93cde1e73087d944c0ea20544137d4121396885826040518082815260200191505060405180910390a25050565b600082828401116101f757600080fd5b81830190509291505056fea265627a7a72315820b0ec951e9499944b4d97be9c5a1b768342aa7ffe319c9af88a7d1837ce9a5d5a64736f6c634300050c0032 
Return_data: 0x6080604052600436106100295760003560e01c8063d96a094a1461002e578063df3cfd771461005c575b600080fd5b61005a6004803603602081101561004457600080fd5b81019080803590602001909291905050506100b9565b005b34801561006857600080fd5b5061009f6004803603604081101561007f57600080fd5b8101908080359060200190929190803590602001909291905050506100d0565b604051808215151515815260200191505060405180910390f35b6100c381346100e6565b6100cd338261010b565b50565b60006100dc83836100e6565b6001905092915050565b6000600154600a84816100f557fe5b040290508082101561010657600080fd5b505050565b6101536000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054826101e7565b6000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff167f0f6798a560793a54c3bcfe86a93cde1e73087d944c0ea20544137d4121396885826040518082815260200191505060405180910390a25050565b600082828401116101f757600080fd5b81830190509291505056fea265627a7a72315820b0ec951e9499944b4d97be9c5a1b768342aa7ffe319c9af88a7d1837ce9a5d5a64736f6c634300050c0032  (*)
Function call:
Constructor() -> RETURN 


Transactions No. 1
Type: CALL (0)
From: normal0(0x4bd5dd46b6ac3bbccc902b6793522b2af3cd5b23) 
To: contract0(0x7804cf72feb0ef67342e2053422914f71f7930b2) 
Value: 0 
Gas used: 210000 
Data: 0xdf3cfd7700000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000 (*)


0xdf3c fd77 
0000000000000000000000000000000000000000000000000000000000000001
0000000000000000000000000000000000000000000000000000000000000000
function is_valid_buy(uint tokens_amount, uint wei_amount)
        _valid_buy(tokens_amount, wei_amount);
        _valid_buy(1, 0);

            _valid_buy(uint desired_tokens, uint wei_sent) 
            _valid_buy(1, 0) 
                uint required_wei_sent = (desired_tokens / 10) * decimals; 
                uint required_wei_sent = (1 / 10) * 1**18 = 0.1 => uint =0

            require(wei_sent >= required_wei_sent);
                    (0 >= 0 )
    



Return_data: 0x0000000000000000000000000000000000000000000000000000000000000001 () (*)

Function call:
is_valid_buy(1,0) -> RETURN (*)
return: 1 (*)




(*) Example solution given. Value is symbolic and may take other values

```

## fix:


```
    function _valid_buy(uint desired_tokens, uint wei_sent) internal view{
       
        uint required_wei_sent = (desired_tokens / 10) * decimals; 
        
        if (required_wei_sent==0){
            revert(); }

        require(wei_sent >= required_wei_sent);
    }
```

run

```
(manticore_native) (REDF)vlad@vladis:play/6_rouding ‹main*›$ python 6_run_fix.py
NO Bug found
```